<!DOCTYPE html>
<html lang="en" ng-app="myApp">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simple AngularJS Order Management</title>

  <!-- AngularJS -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>

  <!-- jsPDF and html2canvas for PDF download -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- CSS -->
  <link rel="stylesheet" href="style.css" />
</head>

<body ng-controller="FormController">

  <p><strong>Current Date & Time:</strong> {{ currentTime | date:'medium' }}</p>

  <h2>Register</h2>
  <form name="regForm" ng-submit="register(regForm)" novalidate>
    <label>Name:
      <input type="text" name="name" ng-model="user.name" required ng-minlength="3" />
    </label>
    <div class="error" ng-show="(regForm.name.$touched || submitted) && regForm.name.$error.required">
      Name is required.
    </div>
    <div class="error" ng-show="(regForm.name.$touched || submitted) && regForm.name.$error.minlength">
      Name must be at least 3 characters.
    </div>
    <br />
    <button type="submit">Register</button>
  </form>
  <p class="success" ng-if="success">{{ success }}</p>

  <hr />

  <h2>Add an Order</h2>
  <form name="billForm" ng-submit="addRecord(billForm)" novalidate>
    <label>Order Name (unique ID):
      <input type="text" name="name" ng-model="newRecord.name" required />
    </label>
    <label>Quantity:
      <input type="number" name="quantity" ng-model="newRecord.quantity" required min="1" />
    </label>
    <label>Amount (per unit):
      <input type="number" name="amount" ng-model="newRecord.amount" required min="0" />
    </label>
    <button type="submit" ng-disabled="billForm.$invalid">Add</button>
  </form>

  <hr />

  <h2>Order Records</h2>
  <div id="ordersTable">
    <table ng-if="records.length > 0">
      <thead>
        <tr>
          <th>Order ID / Name</th>
          <th>Quantity</th>
          <th>Amount (₹ per unit)</th>
          <th>Total (₹)</th>
          <th>Order Date & Time</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="r in records">
          <td>{{ r.name }}</td>
          <td class="right">{{ r.quantity }}</td>
          <td class="right">{{ r.amount | currency:'₹' }}</td>
          <td class="right">{{ (r.quantity * r.amount) | currency:'₹' }}</td>
          <td>{{ r.timestamp | date:'medium' }}</td>
          <td><button ng-click="remove(r)">Delete</button></td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td><strong>Total</strong></td>
          <td class="right"><strong>{{ totalQuantity() }}</strong></td>
          <td></td>
          <td class="right"><strong>{{ totalAmount() | currency:'₹' }}</strong></td>
          <td colspan="2"></td>
        </tr>
      </tfoot>
    </table>
  </div>
  <p ng-if="records.length === 0">No records yet. Add some orders above.</p>

  <button ng-click="downloadPDF()" ng-disabled="records.length === 0">Download Orders as PDF</button>
  <button ng-click="downloadJSON()" ng-disabled="records.length === 0">Download Orders as JSON</button>

  <script src="app.js"></script>
</body>

</html>
